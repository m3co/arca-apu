<!doctype html>
<html>
  <head>
    <script src="https://rawgit.com/rianby64/html-toJSON-example/master/toJSON.js"></script>
    <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
    <script src="node_modules/d3/build/d3.min.js"></script>
    <script src="https://rawgit.com/m3co/arca-utiles/master/import-a-u.js"></script>
    <script src="https://rawgit.com/m3co/arca-utiles/master/selector-contractors.js"></script>
    <script src="client.js"></script>
    <style>
      body {
        font-family: "sans-serif";
        font-size: 10px;
      }
      button {
        padding: 0;
        font-size: 10px;
        font-family: "sans-serif";
      }
    </style>
  </head>
  <body>
    <selector-contractors></selector-contractors>
    <script>
'use strict';
window.contractors = {
  doselect: document.querySelector('selector-contractors').doselect
};
    </script>
    <datalist id="Supplies_type">
      <option>Material</option>
      <option>Mano de Obra</option>
      <option>Equipo</option>
      <option>Herramienta</option>
      <option>Transporte</option>
      <option>Subcontrato</option>
    </datalist>
    <button id="add_APU">+</button>
    <div id="add_APU" hidden>
      <form id="add_APU">
        <input name="description" type="text" placeholder="Descripcion">
        <input name="unit" type="text" placeholder="Unidad">
        <input name="qop" type="number" placeholder="Rdto">
        <input name="estimated" type="number" placeholder="Costo">
        <input name="ContractorId" type="hidden">
        <input type="submit">
      </form>
    </div>
    <script>
'use strict';
(() => {
var ContractorId = location.search.match(/\d+$/);
document.querySelector('input[name="ContractorId"]').value = ContractorId ? ContractorId.toString() : 1;
document.querySelector('button#add_APU').addEventListener('click', e => {
  document.querySelector('div#add_APU').hidden = false;
});
document.querySelector('form#add_APU').addEventListener('submit', e => {
  e.preventDefault();
  var fd = new FormData(e.target).toJSON();
  Object.keys(fd).forEach(k => {
    if (!fd[k]) {
      delete fd[k];
    }
  });
  client.emit('data', {
    query: 'insert',
    module: 'APU',
    row: fd
  });
  document.querySelector('div#add_APU').hidden = true;
});
})();
    </script>
    <div class="blocks"></div>
    <import-a-u-supplies module="importAPUSupplies" a-uid="APUId"></import-a-u-supplies>
    <script src="viewaausupplies.js"></script>
  </body>
</html>
